source $HOME/.nix-profile/share/nix-direnv/direnvrc

layout_python-venv() {
    local python_exe=$(which ${1:-python3})
    local env_dir=$PWD/${2:-venv}
    local python_ver=$($python_exe --version)

    if [[ ! -d $env_dir ]]; then
        log_status "no venv found; creating $env_dir"
        $python_exe -m venv "$env_dir"
    fi

    # activate venv
    unset PYTHONHOME
    export VIRTUAL_ENV="$env_dir"
    PATH_add "$env_dir/bin"

    local local_ver=$(python --version)
    log_status "activating $(user_rel_path $env_dir) ($local_ver)"

    if [[ $local_ver != $python_ver ]]; then
        log_status "upgrading venv to $python_ver"
        $python_exe -m venv --upgrade "$env_dir"
    fi
}
